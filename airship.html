<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ahmed Alazzawi - Water Sampling Airship</title>
    <link rel="icon" href="img/icons8-rocket-64.png" type="image/x-icon">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="ionicons/css/ionicons.min.css" rel="stylesheet">
    <link href="css/animate.min.css" rel="stylesheet">
    <link href="css/aos.css" rel="stylesheet">
    <!-- main style -->
    <link href="css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- Preloader -->
    <div id="preloader">
        <div id="status">

            <div class="preloader" aria-busy="true" aria-label="Loading, please wait." role="progressbar">
            </div>

        </div>
    </div>
    <!-- ./Preloader -->
    
    <!-- header -->
    <header class="navbar-fixed-top">
        <nav>
            <ul>
                <!-- <li><a href="./index.html">Home</a></li> -->
                <li><a href="./index.html#about">About</a></li>
                <li><a href="./index.html#experience">Experience</a></li>
                <li><a href="./index.html#projects">Projects</a></li>
                <li><a href="./index.html#contact">Contact</a></li>
            </ul>
        </nav>
    </header>
    <!-- ./header -->


    <!-- project desc -->
    <div class="section" id="desc"></div>
        <div class="container">
            <div class="portfolio-padding">
                <div class="col-md-8 col-md-offset-2">
                    <!-- title -->
                    <h2>Autonomous Water Sampling Airship </h2>
                    <!-- sub title -->
                    <h3>Vehicle Flight Software and Sampling Payload System Design </h3>
                    <figure>
                        <br /> <center><img src="img/airship/presentation-day-img.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Assembled Airship at Project Presentation Day</center><br /></figcaption>
                    </figure>
                    <!-- <div class="h-50"></div> -->

                    <!-- Project Description -->
                    <h5>Project Description</h5>
                    <!-- <br /> -->
                    <p>The importance of water for our planet and our species cannot be understated, and hydrologists have the essential task of maintaining and testing the water deposits around the world. For this, they require accurate measurement of multiple parameters at multiple locations of any given water body. This is usually done with a multiparameter sensor stack known as a sonde. With many of these water bodies in remote and hard-to-reach locations, sending a hydrologist out to conduct water quality assessments can be difficult and time-consuming. A solution is to construct an Unmanned Autonomous Vehicle (UAV) with the sonde onboard, which would travel to these locations by air. However, current UAV technologies lack the ability to hover for lengthy periods of time while also maintaining a long vehicle range, characteristics necessary for this application of hydrology research in remote areas.</p>

                    <p>The aim of this project is to design and build an autonomous lighter-than-air UAV and payload delivery mechanism that can fly to remote bodies of water, efficiently hover over sampling locations, and deploy an industry-standard sensor array used by hydrologists to gather data about the water’s health and assess its quality. This would eliminate the need for hydrologists to travel, allowing for more efficient data collection. </p>

                    <figure>
                        <br /> <center><img src="img/airship/mock-3.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Airship Sampling Lake Mock Up Image</center><br /></figcaption>
                    </figure>

                    <p>To achieve this goal, the project responsibilities were divided between two cross-functional teams. The Vehicle Team is responsible for delivering and maintaining the vehicle airframe. The Payload Team is then responsible for designing the embedded systems to fly the vehicle and avoid obstacles, the sensor delivery mechanism, and the sampling protocol.</p>

                    <figure>
                        <br /> <center><img src="img/airship/resp.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Team Responsibility Breakdown</center><br /></figcaption>
                    </figure>


                    <figure>
                        <br /> <center><img src="img/airship/agile-methodology.png" alt="" class="img-responsive"  width="100%" height="100"/></center>
                        <figcaption><center>Agile Development Loop (Image courtesy of nvisia.com)</center><br /></figcaption>
                    </figure>


                    <p>The team used Agile methodologies and requirements-driven design to define system requirements, plan sprint goals and tasks, as well as develop, implement, and test project components. This helped the team focus on the end user’s perspective as well as hit project milestones and provide quantifiable deliverables in an efficient and timely manner.</p>
                    <br />
                    <!-- /Project Description -->

                    <!-- System Overview of the Airship Project -->
                    <h5>System Overview of the Airship Project</h5>
                    <p>The diagram below is a system level breakdown of the project’s essential components.</p>
                    <figure>
                        <br /> <center><img src="img/airship/top-block.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>System Top Level Block Diagram</center><br /></figcaption>
                    </figure>

                    <p>The primary subsystems in this project include autopilot software running on the Pixhawk 4 flight controller, obstacle and water detection through computer vision algorithms, embedded software to control the sonde delivery winch mechanism running on a separate On Board Computer (OBC), as well as RF and MAVLink communication layers to connect between the two OBC boards.</p>

                    <p>My responsibility as the Vehicle Flight Software Engineer is to use open-source autopilot software (ArduPilot) to control the experimental airship and get it ready for autonomous flight. Also, as the Payload Systems Engineer, I am responsible for designing and maintaining the payload delivery and sampling protocol at a system level.</p>

                    <br />

                    <!-- /System Overview of the Airship Project -->

                     <!-- System Tests Results -->
                     <h5>System Tests Results</h5>
                    <!-- Vehicle Testing and Results  -->
                    <h4>Vehicle Testing and Results </h4>
                    <p>The vehicle’s first integrated testing was done by suspending the airframe from the ceiling and ensuring that the motors are operating correctly.</p>

                    <figure>
                        <br /> <center><img src="img/airship/testing-setup.png" alt="" class="img-responsive"  width="85%" height="85%"/></center>
                        <figcaption><center>Suspended Vehicle without Envelope</center><br /></figcaption>
                    </figure>

                    <p>The vehicle was then configured to receive input commands from a remote control module as described below.</p>

                    <figure>
                        <br /> <center><img src="img/airship/rc-setup.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Testing Setup with Remote Controller Unit</center><br /></figcaption>
                    </figure>

                    <p>This is the A-tail control surface deflection in response to yaw commands</p>
                    <figure>
                        <br /> <center><img src="img/airship/Atail-yaw.gif" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>A-Tail Yaw Response</center><br /></figcaption>
                    </figure>

                    <p>This is the A-tail control surface deflection in response to pitch commands</p>
                    <figure>
                        <br /> <center><img src="img/airship/Atail-pitch.gif" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>A-Tail Pitch Response</center><br /></figcaption>
                    </figure>

                    <p>This full yaw control with thrust vectoring</p>
                    <figure>
                        <br /> <center><img src="img/airship/full-yaw.gif" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>A-Tail and Thrust Vectoring Yaw Response</center><br /></figcaption>
                    </figure>
                    
                    <br />
                    <!-- /Vehicle Testing and Results  -->

                    <!-- Payload Component Testing -->
                    <h4>Payload Component Testing </h4>

                    <p>Most components were ready for testing near the end of the project lifecycle. The team had to scrap most testing plans and get creative as there was little time left.</p>

                    <figure>
                        <br /> <center><img src="img/airship/cv.gif" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Obstacle Detection CV Test. Subsystem developed by <a href="https://www.linkedin.com/in/atharva-ranadive-16bb86195?original_referer=https%3A%2F%2Fwww.google.com%2F" target="_blank">Atharva Ranadive.</a> </center><br /></figcaption>
                    </figure>
                    
                    <p>TThe obstacle detection algorithm was tested on trees and birds as these objects would make up most of the obstacles the vehicle may run into. Images of the obstacles were printed and moved across the camera’s view. The gif shows the CV algorithms detecting the obstacles. The detection library outputs the location of the obstacles to build a MAVLink message that is sent to the flight controller. The controller then flies the vehicle to avoid the obstacles.</p>

                    <p>Next, the gifs below are from testing the winch control and show how the sampling protocol works. The winch is lowered when the vehicle arrives at a sampling location. This subsystem was developed by <a href="https://www.linkedin.com/in/daniellelaganiere?trk=public_profile_browsemap" target="_blank">Danielle Laganiere.</a></p>

                    <figure>
                        <br /> <center><img src="img/airship/touching-water.gif" alt="" class="img-responsive"  width="50%" height="50%"/></center>
                        <figcaption><center>Winch Controller Lowering Payload - Sensing Water</center><br /></figcaption>
                    </figure>

                    <p>If the capacitive water sensor is sensing water and there is some slack in the winch line, then the vehicle is at a valid sampling location.</p>

                    <figure>
                        <br /> <center><img src="img/airship/slack-no-water.gif" alt="" class="img-responsive"  width="50%" height="50%"/></center>
                        <figcaption><center>Winch Controller Lowering Payload - Sensing Slack in Tension and No Water</center><br /></figcaption>
                    </figure>

                    <p>If the strain sensor senses slack in the line and no water present, then it must be at an invalid location and retracts the sensor.</p>

                    <figure>
                        <br /> <center><img src="img/airship/branch.gif" alt="" class="img-responsive"  width="50%" height="50%"/></center>
                        <figcaption><center>Winch Controller Lowering Payload - Stuck While Retracting</center><br /></figcaption>
                    </figure>

                    <p>Lastly, the system checks for tension while retracting the water sensor. If tension is sensed, there could be a branch in the way. So the controller lowers and pulls the sonde multiple times until it is free. If this takes too long, an error message is sent to the ground station. In this case, the sensor was able to swing itself free.</p>

                    <br />
                    <!-- /Payload Component Testing -->

                    <!-- /System Tests Results -->


                    <!-- The Payload Delivery Vehicle -->
                    <h5>Payload Delivery Vehicle Implementation</h5>

                    <!-- Vehicle Mechanical Design -->
                    <h4>Vehicle Mechanical Design</h4>
                    <figure>
                        <br /> <center><img src="img/airship/vehicle-final.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Vehicle CAD (left) and Final Prototype with 1/4th Scale Envelope Presented at Baskin Engineer Community Presentation Day 2022 (right)</center><br /></figcaption>
                    </figure>
                    <p>The images above show the final versions of the CAD and physically built UAV prototype. The vehicle has a central Aluminum spine with mounting points for the crucial components. </p>

                    <figure>
                        <br /> <center><img src="img/airship/vehicle-annotated.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Annotated Vehicle Diagram</center><br /></figcaption>
                    </figure>
                    <p>The vehicle has an A-tail ruddervator control surface followed by a STOL airfoil wing with a 104’’ wingspan to generate high lift at low speeds. The wing itself does not have ailerons as roll control is not a requirement. Next, a custom-built vectored thrust section comes to the fore of the wing. The thrust section is mounted at the vehicle’s center of gravity. After this, the flight electronics bay and payload deployment winch mechanism are also mounted to the vehicle. Finally, the 384 ft^3 helium envelope is mounted above the spine.</p>

                    <p>In summary, the vehicle has an A-tail control surface to be controlled by servos and thrust vectored propulsion from two BLDC motors whose vectors are controlled by two more servo motors.</p>

                    <!-- <p>Note: during initial testing, the team quickly noticed the spine is non-rigid and caused unstable oscillations. Also, mounting the flight controller and sensors at the center of mass instead of at the end of the spine allows for more accurate measurements of the vehicle’s state.</p> -->
                    <br />
                    <!-- /Vehicle Mechanical Design -->

                    <!-- Vehicle Electronics and Final Circuit -->
                    <h4>Vehicle Electronics and Final Circuit</h4>
                    <figure>
                        <br /> <center><img src="img/airship/vehicle-circuit.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Vehicle Circuit Block Diagram</center><br /></figcaption>
                    </figure>

                    <p>The circuit block diagram above shows the final iteration of the vehicle’s electronics. The brain of the system is the Pixhawk 4 Flight Computer. This device runs the customized ArduPilot software and sends commands to the vehicle’s actuators. There are two BLDC motors and four servo motors on the airship. Two of these servo motors are mounted on the A-tail's control surfaces, the other two are used to vector the thrust generated by the two BLDC motors. The BLDC motors are driven by 35A ESC chips which operate using DShot600 commands.</p>

                    <p>The Pixhawk 4 also connects to an external GPS module through UART as well as an SBUS receiver to capture radio communications sent from a remote control module. The Pixhawk also provides telemetry data to the ground station through a separate telemetry module. Finally, it is also connected to a Raspberry Pi 4 which runs the water sampling protocol and obstacle detection compute vision algorithms.</p>
                    <br />
                    <!-- /Vehicle Electronics and Final Circuit -->


                    <!-- Vehicle Software  -->
                    <h4>Vehicle Software</h4>
                    <p>The software utilizes the open-source autopilot libraries provided by ArduPilot. ArduPilot provides community tested autopilot control loop source code for conventional UAV frames such as fixed wing planes, multicopters, and blimps. The team’s vehicle does not exactly fit into those categories as it is a mixture of multiple aircraft types.</p>

                    <figure>
                        <br /> <center><img src="img/airship/vehicle-types.png" alt="" class="img-responsive"  width="60%" height="60%"/></center>
                        <figcaption><center>ArduPilot Vehicle Types</center><br /></figcaption>
                    </figure>

                    <p>Through iterative design and development, it was found that using the base Multicopter/Bicopter ArduPilot model’s source code and customizing it to add A-tail surface functionality gave the best result. A breakdown of the vehicle’s actuators can be seen in the image below. </p>

                    <figure>
                        <br /> <center><img src="img/airship/vehicle-breakdown.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Airship Breakdown</center><br /></figcaption>
                    </figure>

                    <p>The software’s main loop, which runs at 400Hz on the Pixhawk 4, follows the diagram top level flowchart below.</p>

                    <figure>
                        <br /> <center><img src="img/airship/main-loop.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>ArduPilot Main Loop</center><br /></figcaption>
                    </figure>

                    <p>The software first determines which mode (Manual, Stabilize, Guided, RTL, etc.) it is in as that determines the desired behavior. Then it calls the mode’s respective run function. This function would then determine the necessary attitude commands and set the motor outputs to achieve the desired state. These commands are calculated based on their respective control loops. At a high level, each controller for yaw, pitch, and roll follows the following structure.</p>

                    <figure>
                        <br /> <center><img src="img/airship/control-loop.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>ArduPilot Controller High Level Diagram</center><br /></figcaption>
                    </figure>

                    <p>Each control loop translates input commands to angle rates which are then used to generate motor commands to push the vehicle to the desired state. Below is a more detailed description of how the loops are structured.</p>

                    <figure>
                        <br /> <center><img src="img/airship/controllers.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>ArduCopter v4.x Roll, Pitch, Yaw Control Loops Diagram Courtesy of ArduPilot.org</center><br /></figcaption>
                    </figure>
                    <br />
                    <!-- /Vehicle Software  -->

                    <!-- Motor Control -->
                    <h4>Motor Control</h4>
                    <p>To ensure correct motor operation, a vehicle command to motor actuation table was made. The table details the expected motor behavior given any vehicle command. This was used to inform the autopilot design and verify the vehicle’s behavior.</p>

                    <figure>
                        <br /> <center><img src="img/airship/motor-table.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Vehicle Commands to Motor Outputs v1.0</center><br /></figcaption>
                    </figure>

                    <p>For context, this image describes the tail deflection direction </p>

                    <figure>
                        <br /> <center><img src="img/airship/context.png" alt="" class="img-responsive"  width="50%" height="50%"/></center>
                        <figcaption><center>A-tail Deflection Reference using Vehicle Assembly v2.0, rear view</center><br /></figcaption>
                    </figure>

                    <p>The UML diagram below shows how the C++ motor control library is set up </p>

                    <figure>
                        <br /> <center><img src="img/airship/motor-uml.png" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>Airship ArduPilot Motor Classes UML Diagram</center><br /></figcaption>
                    </figure>

                    <p>To control the vehicle’s motors, the software uses the <em>AP_MotorsTailSitter</em> motor class which inherits from the <em>AP_MotorsMulticopter</em> and <em>AP_Motors_Class</em> classes. It initializes the 4 motors required for thrust vectoring and can calculate the output for each motor. This class’s initialization function, <em>AP_MotorsTailsitter::init()</em>, was modified to set up 2 more motors used to control the A-tail. Then, using the pitch and yaw thrust values calculated in <em>AP_MotorsTailsitter::output_armed_stabilizing()</em>, the A-tail motor output is calculated as such: </p>

                    <p><em>_Atail_left = pitch_thrust - yaw_thrust</em></p>
                    <p><em>_Atail_right = pitch_thrust + yaw_thrust</em></p>

                    <p>Finally, <em>AP_MotorsTailsitter::output_to_motors()</em> is used to send new motor signals.</p>

                    <p>The A-tail motor commands are calculated based off pitch and yaw thrust values as these are the angles the tail surfaces are controlling.</p>

                    <figure>
                        <br /> <center><img src="img/airship/Atail-pitch.gif" alt="" class="img-responsive"  width="75%" height="75%"/></center>
                        <figcaption><center>A-Tail Motor Response to Manual Pitch Commands</center><br /></figcaption>
                    </figure>
                    
                    <br />
                    <!-- /Motor Control -->

                    <!-- Mission Planning  -->
                    <h4>Mission Planning </h4>
                    <p>One of the main reasons why ArduPilot was chosen is because it provides the pilot or user with the ability to create, simulate, and upload fully autonomous missions for the aircraft to follow. The team had chosen a test mission to sample the Lexington Reservoir. The mission is created through the MissionPlanner software interface as seen below and can be uploaded to any compatible flight controller unit such as the Pixhawk4 through USB.</p>

                    <figure>
                        <br /> <center><img src="img/airship/mission.png" alt="" class="img-responsive"  width="50%" height="50%"/></center>
                        <figcaption><center>Lexington Reservoir Sampling Mission with Waypoints (~5Km Mission)</center><br /></figcaption>
                    </figure>

                    <br />
                    <!-- /Mission Planning  -->

                    
                    <!-- Vehicle Status and Next Steps -->
                    <h4>Vehicle Status and Next Steps  </h4>
                    <p>As of June 2022, the vehicle can correctly respond to input commands from a remote-control module. Since these commands are the same as what would be sent in autonomous modes, the next steps are to rigorously tune each individual control loop in the software until reaching the desired stable outcome. </p>

                   <p>After this, simple tests to verify basic functionality such as Vertical Take-Off and Landing (VTOL), flying small distances, returning to home location, and switching between manual and autonomous modes. Once the vehicle passes all tests and checks, it is ready for full autonomous testing and eventually attempting an autonomous sampling mission.</p>
                    <br />
                    <!-- /Vehicle Status and Next Steps -->

                    <!-- /The Payload Delivery Vehicle -->

                    <!-- Water Sampling Payload System Design -->
                    <h5>Water Sampling Payload System Design </h5>
                    <figure>
                        <br /> <center><img src="img/airship/payload-sys.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Payload System Block Diagram</center><br /></figcaption>
                    </figure>
                    
                    <p>The diagram above shows the final iteration of the payload system. This was then translated to the circuit block diagram below.</p>

                    <figure>
                        <br /> <center><img src="img/airship/payload-circuit.png" alt="" class="img-responsive"  width="100%" height="100%"/></center>
                        <figcaption><center>Payload Circuit Block Diagram</center><br /></figcaption>
                    </figure>

                    <br />
                    <!-- /Water Sampling Payload System Design -->                    

                    <!-- Project Status and Next Steps -->
                    <h5>Project Status and Next Steps</h5>
                    <p>This project was for the UCSC Electrical and Computer Engineering Capstone 3 course series. As of June 2022, most core components were individually tested and verified or in the preliminary stages of integration. However, as the school year ended, the team members graduated and moved on to other projects.</p>

                    <p>If the team were to continue working on this project, the next steps for the vehicle would be stabilizing the spine with more rigid materials and beginning to tune the flight control loops. Next steps for the payload would be to finish integrating subsystems and test the full system. After this, the planned testing discussed above can be started.</p>
                    <!-- /Project Status and Next Steps -->



                </div>

            



            </div>
        </div>
    <!-- ./project desc -->


    <!-- links -->
    <div class="h-50"></div>
    <div class="h-50"></div>
    <center><a href="./index.html#projects"><h5><u>See More Projects</u></h5></a></center>
    <br />
    <center><a href="./index.html#contact"><h5><u>Contact</u></h5></a></center>
    <div class="h-50"></div>
    <div class="h-50"></div>
    <!-- ./links -->
    
    
    <!-- jQuery -->
    <script src="js/jquery.js"></script>
    <!--  plugins  -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/plugins.js"></script>
    <script src="js/aos.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>

    <!--  main script  -->
    <script src="js/custom.js"></script>
</body>

</html>
